#!/usr/bin/env bash
# Ignore SC2086 as requested
# shellcheck disable=SC2086

# ---------------------------
# Function: get_record
# Params: domain, subdomain
# Description:
#   Performs dig lookup and prints the required output
# ---------------------------
get_record() {
    local domain=$1
    local subd=$2
    full="${subd}.${domain}"

    # Run dig, extract ANSWER SECTION, use awk to get record + destination
    output=$(dig $full | grep -A1 "ANSWER SECTION:" | tail -n1)

    # Use awk to parse:
    # $4 = record type
    # $5 = destination
    record_type=$(echo "$output" | awk '{print $4}')
    destination=$(echo "$output" | awk '{print $5}')

    echo "The subdomain ${subd} is a ${record_type} record and points to ${destination}"
}

domain=$1
subdomain=$2

# If only domain is provided â†’ check all required subdomains in this specific order
if [ -z "$subdomain" ]; then
    for s in www lb-01 web-01 web-02
    do
        get_record "$domain" "$s"
    done
else
    # Only check the provided subdomain
    get_record "$domain" "$subdomain"
fi
